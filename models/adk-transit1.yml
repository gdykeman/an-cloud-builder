---
demo_name: "{{ opt_name | default('adk-transit1') }}"
demo_instance: "{{ opt_instance | default(lookup('env','USER')) }}"
cloud_name: "{{ demo_name }}.{{ demo_instance }}"
cloud_provider: aws
cloud_region: us-east-1
cloud_user: ec2-user
ansible_ssh_private_key_file: "keys/{{ cloud_name }}_key"
ansible_ssh_public_key_file: "keys/{{ cloud_name }}_key.pub"

cloud_acls:
  host-acl:
    - { src_ip: 0.0.0.0/0, proto: all }
  rtr-acl:
    - { src_ip: 0.0.0.0/0, proto: all }
vpc_list:
  - name: "vpc1.{{ cloud_name }}"
    provider: "{{ cloud_provider }}"
    region: "{{ cloud_region }}"
    project: "{{ cloud_name }}"
    cidr: 10.1.0.0/16
    bgp_asn: 65101
    acl_list:
      - host-acl
      - rtr-acl
    networks:
      - { name: "outside.vpc1.{{ cloud_name }}", cidr: "10.1.0.0/24", az: "{{ cloud_region }}a" }
      - { name: "inside.vpc1.{{ cloud_name }}", cidr: "10.1.1.0/24", az: "{{ cloud_region }}a" }
    instances:
      - name: "host1.vpc1.{{ cloud_name }}"
        size: micro
        image: centos7
        ansible_user: centos
        interfaces:
          - name: eth0
            subnet: "inside.vpc1.{{ cloud_name }}"
            acl: host-acl
        tags:
          Owner: "{{ cloud_name }}"
          groups: host
      - name: "rtr1.vpc1.{{ cloud_name }}"
        size: medium
        image: csr-byol
        interfaces:
          - name: gigabitethernet1
            subnet: "outside.vpc1.{{ cloud_name }}"
            acl: rtr-acl
            public_ip: true
          - name: gigabitethernet2
            subnet: "inside.vpc1.{{ cloud_name }}"
            acl: rtr-acl
            private_ip_cidr: 10.1.1.254
            gateway: yes
        tags:
          Owner: "{{ cloud_name }}"
          network_os: ios
          groups: 'network,routers,spokes'
  - name: "vpc2.{{ cloud_name }}"
    provider: "{{ cloud_provider }}"
    region: "{{ cloud_region }}"
    project: "{{ cloud_name }}"
    cidr: 10.2.0.0/16
    bgp_asn: 65102
    acl_list:
      - host-acl
      - rtr-acl
    networks:
      - { name: "outside.vpc2.{{ cloud_name }}", cidr: "10.2.0.0/24", az: "{{ cloud_region }}a" }
      - { name: "inside.vpc2.{{ cloud_name }}", cidr: "10.2.1.0/24", az: "{{ cloud_region }}a" }
    instances:
      - name: "host1.vpc2.{{ cloud_name }}"
        size: micro
        image: centos7
        ansible_user: centos
        interfaces:
          - name: eth0
            subnet: "inside.vpc2.{{ cloud_name }}"
            acl: host-acl
        tags:
          Owner: "{{ cloud_name }}"
          groups: host
      - name: "rtr2.vpc2.{{ cloud_name }}"
        size: medium
        image: eos-byol
        key_name: "{{ cloud_name }}"
        interfaces:
          - name: ethernet1
            subnet: "outside.vpc2.{{ cloud_name }}"
            acl: rtr-acl
            public_ip: true
          - name: ethernet2
            subnet: "inside.vpc2.{{ cloud_name }}"
            acl: rtr-acl
            private_ip_cidr: 10.2.1.254
            gateway: yes
        tags:
          Owner: "{{ cloud_name }}"
          network_os: eos
          groups: 'network,routers,spokes'
  - name: "transit.{{ cloud_name }}"
    provider: "{{ cloud_provider }}"
    region: "{{ cloud_region }}"
    project: "{{ cloud_name }}"
    cidr: 10.0.0.0/16
    bgp_asn: 65100
    acl_list:
      - rtr-acl
    networks:
      - { name: "outside.transit.{{ cloud_name }}", cidr: "10.0.0.0/24", az: "{{ cloud_region }}a" }
    instances:
      - name: "rtr3.transit.{{ cloud_name }}"
        size: xlarge
        image: iosxr-byol
        ansible_user: root
        interfaces:
          - name: ethernet1
            subnet: "outside.transit.{{ cloud_name }}"
            acl: rtr-acl
            public_ip: true
        tags:
          Owner: "{{ cloud_name }}"
          network_os: iosxr
          groups: "network,routers,hubs"
      - name: "control.transit.{{ cloud_name }}"
        size: medium
        image: centos7
        ansible_user: centos
        interfaces:
          - name: eth0
            subnet: "outside.transit.{{ cloud_name }}"
            acl: host-acl
            public_ip: true
        tags:
          Owner: "{{ cloud_name }}"
          groups: 'control,host'
    routes:
      - { subnet: "outside.transit.{{ cloud_name }}", cidr: "10.1.1.0/24", instance: "rtr3.transit.{{ cloud_name }}" }
      - { subnet: "outside.transit.{{ cloud_name }}", cidr: "10.2.1.0/24", instance: "rtr3.transit.{{ cloud_name }}" }

cloud_image_map:
  aws:
    us-east-1:
      csr-byol: ami-bcbfb9c7
      iosxr-byol: ami-b375f2c9
      eos-byol: ami-d9eb63a3
      centos7: ami-02e98f78
    ca-central-1:
      centos7: ami-b111aad5
  azure:
    rhel7: { offer: CentOS, publisher: OpenLogic, sku: 7.4, version: latest }

cloud_size_map:
  aws:
    micro: t2.micro
    medium: t2.medium
    xlarge: m4.xlarge
  azure:
    micro: Standard_A0
    medium: Standard_A2_v2


tunnels:
  - { index: 0, key: 101, src_host: "transit-rtr", src_ip_addr: "10.255.0.1/30", dst_host: "vpc1-rtr", dst_ip_addr: "10.255.0.2/30" }
  - { index: 1, key: 101, src_host: "transit-rtr", src_ip_addr: "10.255.0.5/30", dst_host: "vpc2-rtr", dst_ip_addr: "10.255.0.6/30" }
