---
- name: Configure the control node
  hosts: control
  become: yes
  tasks:
    - name: Install EPEL repository
      yum:
        name: epel-release
        state: present

    - name: Update all packages
      yum:
        name: '*'
        state: latest

    - name: Install YUM packages
      yum:
        name: "{{ item }}"
        state: latest
      with_items:
        - python-pip
        - python-devel
        - python-netaddr
        - openssl-devel
        - sudo
        - git

    - name: Install Ansible
      pip:
        name: 'git+git://github.com/ansible/ansible.git'

    - name: Install PIP packages
      pip:
        name: "{{ item }}"
        state: latest
      with_items:
        #- ansible
        - paramiko
        - PyYAML
        - Jinja2
        - httplib2
        - six
        #- shade
        - jxmlease
        - ncclient
        - pexpect
        - f5-sdk
        - bigsuds
        - pan-python
        - pandevice
        - requests
        - pyopenssl

    - name: Install the an-demo-kit
      git:
        repo: https://github.com/ismc/an-demo-kit.git
        dest: "~{{ ansible_ssh_user }}/an-demo-kit"

    - name: Create the inventory directory
      file:
        path: "~{{ ansible_ssh_user }}/an-demo-kit/inventory/"
        state: directory
        owner: "{{ ansible_ssh_user }}"
        mode: 0755

    - name: Create the keys directory
      file:
        path: "~{{ ansible_ssh_user }}/an-demo-kit/keys"
        state: directory
        owner: "{{ ansible_ssh_user }}"
        mode: 0755

    - name: Copy the ssh key
      copy:
        src: "{{ ansible_ssh_private_key_file }}"
        dest: "~{{ ansible_ssh_user }}/an-demo-kit/keys"
        owner: "{{ ansible_ssh_user }}"
        mode: 0600

    - name: Copy the inventory
      copy:
        src: "{{ inventory_dir }}"
        dest: "~{{ ansible_ssh_user }}/an-demo-kit/inventory/"
        owner: "{{ ansible_ssh_user }}"
        mode: 0644

    - name: create the .ansible.cfg
      blockinfile:
        path: "~{{ ansible_ssh_user }}/.ansible.cfg"
        create: yes
        block: |
          [defaults]
          host_key_checking = False

    - debug: msg="Control node public IP':' {{ ansible_host }}"

    #
    # - name: Create the inventory file on the control node(s)
    #   template:
    #     src: inventory.j2
    #     dest: ~/inventory/hosts
    #
    # - name: Create the host_vars directory
    #   file:
    #     path: ~/inventory/host_vars
    #     state: directory
    #     mode: 0755
    #
    # - name: Create the group_vars directory
    #   file:
    #     path: ~/inventory/group_vars
    #     state: directory
    #     mode: 0755
    #
    # - debug: var=hostvars[inventory_hostname]
