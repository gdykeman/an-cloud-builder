---
demo_name: "{{ opt_name | default('adk-mx1') }}"
demo_instance: "{{ opt_instance | default(lookup('env','USER')) }}"
cloud_name: "{{ demo_name }}.{{ demo_instance }}"
cloud_provider1: aws
cloud_region1: "{{ opt_region1 | default('us-east-1') }}"
cloud_provider2: "{{ cloud_provider1 }}"
cloud_region2: "{{ opt_region1 | default(cloud_region1) }}"
cloud_user: ec2-user
ansible_ssh_private_key_file: "{{ playbook_dir }}/keys/{{ cloud_name }}"

acl_dict:
  host-acl:
    - { src_ip: 0.0.0.0/0, dst_ports: 22, proto: tcp }
    - { src_ip: 0.0.0.0/0, dst_ports: 443, proto: tcp }
    - { src_ip: 0.0.0.0/0, proto: icmp }
  rtr-acl:
    - { src_ip: 0.0.0.0/0, proto: all }
ssh_keys: "{ '{{ cloud_name }}': '{{ lookup('file', {{ ansible_ssh_private_key_file }} ) }}' }"
vpc_list:
  - name: "vpc1.{{ cloud_name }}"
    provider: "{{ cloud_provider1 }}"
    region: "{{ cloud_region1 }}"
    project: "{{ cloud_name }}"
    cidr: 172.17.0.0/16
    acl_list:
      - host-acl
      - rtr-acl
    networks:
      - { name: "mgmt.vpc1.{{ cloud_name }}", cidr: "172.17.0.0/24", az: "{{ cloud_region1 }}a" }
      - { name: "outside.vpc1.{{ cloud_name }}", cidr: "172.17.1.0/24", az: "{{ cloud_region1 }}a" }
    instances:
      - name: "rtr1.{{ cloud_name }}"
        size: xlarge
        image: mx-payg
        key_name: test.scarter
        interfaces:
          - name: fxp0
            subnet: "mgmt.vpc1.{{ cloud_name }}"
            acl: rtr-acl
            private_ip: 172.17.0.254
            public_ip: true
          - name: GigabitEthernet0
            subnet: "outside.vpc1.{{ cloud_name }}"
            acl: rtr-acl
            private_ip: 172.17.1.254
            public_ip: true
        tags:
          Owner: student
          network_os: junos
          groups: network,routers
      - name: "control.{{ cloud_name }}"
        size: medium
        image: centos7
        cloud_user: centos
        # volume_size: 20
        interfaces:
          - name: eth0
            subnet: "mgmt.vpc1.{{ cloud_name }}"
            acl: host-acl
            public_ip: true
        tags:
          Owner: "{{ demo_instance }}"
          groups: control
    routes:
      - { subnet: "outside.vpc1.{{ cloud_name }}", cidr: "172.18.2.0/24", instance: "rtr1.{{ cloud_name }}" }
  - name: "vpc2.{{ cloud_name }}"
    provider: "{{ cloud_provider2 }}"
    region: "{{ cloud_region2 }}"
    project: "{{ cloud_name }}"
    cidr: 172.18.0.0/16
    acl_list:
      - host-acl
      - rtr-acl
    networks:
      - { name: "mgmt.vpc2.{{ cloud_name }}", cidr: "172.18.0.0/24", az: "{{ cloud_region2 }}b" }
      - { name: "outside.vpc2.{{ cloud_name }}", cidr: "172.18.1.0/24", az: "{{ cloud_region2 }}b" }
      - { name: "inside.vpc2.{{ cloud_name }}", cidr: "172.18.2.0/24", az: "{{ cloud_region2 }}b" }
    instances:
      - name: "rtr2.{{ cloud_name }}"
        size: xlarge
        image: mx-payg
        interfaces:
          - name: fxp0
            subnet: "mgmt.vpc2.{{ cloud_name }}"
            acl: rtr-acl
            public_ip: true
            private_ip: 172.18.0.254
          - name: GigabitEthernet1
            subnet: "outside.vpc2.{{ cloud_name }}"
            acl: rtr-acl
            public_ip: true
            private_ip: 172.18.1.254
          - name: GigabitEthernet1
            subnet: "inside.vpc2.{{ cloud_name }}"
            acl: rtr-acl
            private_ip: 172.18.2.254
            gateway: yes
        tags:
          Owner: "{{ demo_instance }}"
          network_os: junos
          groups: network,routers
      - name: "host1.{{ cloud_name }}"
        size: micro
        image: centos7
        interfaces:
          - name: eth0
            subnet: "inside.vpc2.{{ cloud_name }}"
            acl: host-acl
        tags:
          Owner: "{{ demo_instance }}"
          groups: hosts

group_vars:
  all:
    domain_name: localdomain
    domain_search:
      - localdomain
      - example.com
    name_servers:
      - 8.8.8.8
      - 8.8.4.4

cloud_image_map:
  aws:
    us-east-1:
      mx-payg: ami-cda287b6
      mx-byol: ami-e5a6839e
      centos7: ami-02e98f78
    ca-central-1:
      mx-byol: ami-1df44a79
      centos7: ami-b111aad5

cloud_size_map:
  aws:
    micro: t2.micro
    medium: t2.medium
    xlarge: m4.xlarge
